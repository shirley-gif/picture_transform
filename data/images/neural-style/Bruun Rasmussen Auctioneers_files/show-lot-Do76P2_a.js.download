var J=Object.defineProperty;var X=(e,t,i)=>t in e?J(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;var m=(e,t,i)=>(X(e,typeof t!="symbol"?t+"":t,i),i);import{K as f,G as Q,T as Y,d as Z,b as x,C as S,k as N,l as h,r as M,q as ee,R as te,j as ie,s as se,m as ne}from"./rounding-ladder-wLPrDnYU.js";import{B as l}from"./br-jquery-n-_lw8_2.js";import{b as k}from"./function-BTOlBQHE.js";import{D as re,B as A}from"./current-page-DQ4fydFV.js";import{r as oe}from"./ready-rDJOzJ7p.js";function ue(e,t){const i=l(e),s=i.find("input[type=number]"),n=i.find(".maxbid-suggestions"),o=i.find("[type=submit]"),c=Number(s.attr("min"));function L(){n.fadeIn("fast")}function p(){n.fadeOut("fast")}const y=function(){const r=Number(s.val());return r<c?!1:t.suggestMaxBids(r,c).indexOf(r)>=0},g=()=>o.prop("disabled",!y()),O=function(r){let a;r.preventDefault();const d=n.find(".current");if(d.length===0?a=n.find("li:first-child"):a=d.closest("li").next("li"),a.length>0)return d.removeClass("current"),a.addClass("current")},R=function(r){let a;r.preventDefault();const d=n.find(".current");if(d.length===0?a=n.find("li:last-child"):a=d.closest("li").prev("li"),d.removeClass("current"),a.length>0)return a.addClass("current")},w=function(r){return s.val(r.text()),g(),p()},U=function(r){if(!n.is(":visible"))return;const a=n.find(".current");if(a.length>0)return w(a),r.preventDefault()},D=function(r){if(r.length>0)if(y())p();else{const a=Number(r),j=t.suggestMaxBids(a,c).map(G=>"<li>"+G+"</li>").join("");l("ul",n).html(j),L()}else p();return g()},W=function(){const r=s.val();D(r);try{return s[0].setSelectionRange(0,r.length)}catch{}},F=()=>p(),K=function(r){switch(r.keyCode){case f.ARROW_DOWN:O(r);break;case f.ARROW_UP:R(r);break;case f.ENTER:U(r);break}},H=function(r){if(r.keyCode!==f.ARROW_DOWN&&r.keyCode!==f.ARROW_UP)return D(s[0].value)},z=function(r){return w(l(this)),r.preventDefault()},V=function(){return s.on("focus.free_form_max_bid",W),s.on("keydown.free_form_max_bid",K),s.on("keyup.free_form_max_bid",H),s.on("blur.free_form_max_bid",F),n.on("click.free_form_max_bid","li",z)},q=function(){V(),g(),i.data("MaxBidInput",!0),console.debug("MaxBidInput initialized")};if(!i.data("MaxBidInput"))return q()}class ce{constructor(t,i=[]){m(this,"ladder");m(this,"overrideSteps");this.ladder=t,this.overrideSteps=i}floor(t){return this.overrideSteps.length===0?this.ladder.floor(t):t<this.overrideSteps[0]?this.ladder.floor(t):this.overrideSteps[this.overrideSteps.length-1]<t?Math.max(this.ladder.floor(t),this.overrideSteps[this.overrideSteps.length-1]):this.overrideSteps.find((i,s)=>{const n=this.overrideSteps[s+1];return t<n})}ceil(t){return this.overrideSteps.length===0?this.ladder.ceil(t):t<this.overrideSteps[0]?Math.min(this.ladder.ceil(t),this.overrideSteps[0]):this.overrideSteps[this.overrideSteps.length-1]<t?this.ladder.ceil(t):this.overrideSteps.find(i=>t<=i)}searchDecade(t,i){const s=[this.floor(t)];for(let n=1,o=i,c=1<=o;c?n<o:n>o;c?n++:n--)s.push(this.ceil(s[n-1]+1));return s}suggestMaxBids(t,i,s=4){let n=Math.max(t,1);if(n<i)if(i.toString().indexOf(n.toString())===0)n=i;else for(;n<i;)n=10*n;return this.searchDecade(n,s)}}function ae(e,t){const i="=".repeat((4-e.length%4)%4),s=(e+i).replace(/-/g,"+").replace(/_/g,"/"),n=t(s),o=new Uint8Array(n.length);for(let c=0;c<n.length;++c)o[c]=n.charCodeAt(c);return o}function le(e){return ae(e,atob)}var B;const P=((B=document.querySelector("meta[name='csrf-token']"))==null?void 0:B.content)||"",u={subscribe:k,unsubscribe:k,async deleteSubscription(){console.info("Deleting push subscription..."),await fetch("/m/push_subscription",{method:"DELETE",headers:{"X-CSRF-Token":P},credentials:"same-origin"}),console.info("Push subscription deleted")},async saveSubscription(e,t){console.info("Saving subscription...");try{await fetch("/m/push_subscription",{method:"POST",body:JSON.stringify({subscription:e.toJSON(),shouldSendTestNotification:t}),headers:{"X-CSRF-Token":P,"Content-Type":"application/json"}}),console.info("Subscription saved")}catch(i){console.error("Failed to add subscription",i)}},currentState:Q({isInitialized:!1,isSupported:!1,permission:"prompt",subscription:"unknown"})},de=async function(e){const t=le(e);if(!("Notification"in window)){console.warn("This browser does not support desktop notification");return}if(!navigator.serviceWorker){console.warn("Service worker is not supported in this browser");return}const i={userVisibleOnly:!0,applicationServerKey:t},s=await navigator.serviceWorker.ready;if(s.pushManager==null){console.warn("Push messages not supported");return}u.unsubscribe=async function(c){console.info("Unsubscribing to Push Notifications..."),await c.unsubscribe(),console.info("Unsubscribed"),u.currentState.subscription="none"},u.subscribe=async function(){try{console.info("Subscribing to Push Notifications..."),u.currentState.subscription=await s.pushManager.subscribe(i),console.info("Subscription created")}finally{u.currentState.permission=await s.pushManager.permissionState()}},u.currentState.isSupported=!0;const n=await s.pushManager.permissionState(i);console.debug(`Current Push permission is: ${n}`),u.currentState.permission=n;const o=await s.pushManager.getSubscription();if(u.currentState.isInitialized=!0,o==null){console.info("Client is not subscribed to Push Messages"),u.currentState.subscription="none";return}if(o.options.applicationServerKey&&!fe(new Uint8Array(o.options.applicationServerKey),t)){console.warn("Current subscription is not using the correct VAPID key. Unsubscribing... "),await o.unsubscribe(),u.currentState.subscription="none";return}console.info("Client is subscribed to Push Messages"),u.currentState.subscription=o,u.currentState.isInitialized=!0};function fe(e,t){if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}function he(e){const t=e.$options.destroyEvent||be();document.addEventListener(t,function i(){e.$destroy(),document.removeEventListener(t,i)})}const pe={beforeMount:function(){this===this.$root&&this.$el&&(he(this),this.$cachedHTML=this.$el.outerHTML,this.$once("hook:destroyed",function(){this.$el.parentNode&&(this.$el.outerHTML=this.$cachedHTML)}))}};function be(){return typeof Turbo<"u"?"turbo:visit":"turbolinks:visit"}const ge=Y.days(30).inMilliseconds(),me=Z({mixins:[pe],data(){return{push:u.currentState,lastDeclined:0,subscriptionStatus:2,shouldSendTestNotification:!1,isWaiting:!1,hasFailed:!1}},computed:{isSubscriptionUnpersisted(){return this.subscriptionStatus===1},isSubscriptionPersisted(){return this.subscriptionStatus===0},isPermissionDenied(){return this.push.permission==="denied"},isPermissionGranted(){return this.push.permission==="granted"},isSubscribed(){return this.push.subscription!=="none"&&this.push.subscription!=="unknown"},isUnsubscribed(){return this.push.subscription==="none"},shouldPrompt(){return!(!this.push.isSupported||this.hasFailed||this.isPermissionGranted||this.isPermissionDenied||this.isDeclined)},isDeclined(){return Date.now()-this.lastDeclined<ge},shouldDeleteSubscription(){return this.isSubscriptionPersisted?this.isPermissionDenied:!1},shouldSaveSubscription(){return this.isSubscribed?this.isSubscriptionUnpersisted:!1},shouldSubscribe(){return this.isPermissionGranted&&this.isUnsubscribed}},watch:{shouldDeleteSubscription:{async handler(e){e&&(await u.deleteSubscription(),this.isSubscriptionPersisted=!1)},immediate:!0},shouldSaveSubscription:{async handler(e){e&&(this.push.subscription==="unknown"||this.push.subscription==="none"||(await u.saveSubscription(this.push.subscription,this.shouldSendTestNotification),this.isSubscriptionPersisted=!0,this.shouldSendTestNotification=!1))},immediate:!0},shouldSubscribe:{async handler(e){e&&await u.subscribe()},immediate:!0}},created(){this.lastDeclined=Number(localStorage.getItem("push-notifications-declined"))},mounted(){const e=JSON.parse(this.$el.dataset.pushSubscriptionPersisted);this.subscriptionStatus=e?0:1},methods:{async accept(){try{this.isWaiting=!0,console.log("Accepting push notifications..."),this.shouldSendTestNotification=!0,await u.subscribe(),console.log("Push notifications accepted!")}catch(e){throw console.error("Failed to accept push notifications",e),this.hasFailed=!0,e}finally{this.isWaiting=!1}},decline(){console.log("Declining push notifications..."),this.lastDeclined=Date.now(),localStorage.setItem("push-notifications-declined",String(this.lastDeclined)),console.log("Push notifications declined")}}});let v=!1;const E=function(){let e;const t=l(".summarize-list");if(!(t.length>0))return;const i=()=>t.find("tr").length*40;let s=e=function(){t.css("height",i()),o.text(x("announced_bids.show_fewer")),v=!0,s=n};const n=function(){t.css("height",""),o.text(x("announced_bids.show_more")),v=!1,s=e};let o=t.next(".secondary-action");o.length===0&&(o=l('<button class="toggle-more-bids secondary-action" />'),o.insertAfter(t),o.on("click",function(c){s(),c.preventDefault()})),v?e():n()},Se=1e4;let I;const ve=function(e){if(S.isLoggedIn&&ye()){const t=l("#lot-info").data("lot-id");N.getAnnouncedBids(t,Date.now(),function(i){const s=i[0];s.customerNumber!=S.customerNumber&&(re({message:"Customer presented as highest bidder when outbid. Calling fallback callback.",extra:{lotId:t,overbidId:s.id,customerNumber:S.customerNumber,lotEventsIsConnected:h.isConnected(),lastLotEventKeepaliveCheck:h.lastKeepaliveIntervalCheck()}}),e())})}},ye=function(){const e=l("#customer-bid-status").data("status");return e!==void 0&&e=="customer_has_highest_bid"},we=function(e){clearInterval(I),I=setInterval(ve,Se,e)};var _;const C=(_=document.querySelector('meta[name="vapid-public-key"]'))==null?void 0:_.getAttribute("content");C!=null&&de(C);const $=()=>{const e=document.getElementById("free-form");if(e==null)return;const{decade:t,overrideSteps:i}=Object.assign({decade:[],overrideSteps:[]},ee(e,"biddingLadder")),s=new ce(new te(t),i);ue(e,s)},De=function(){document.getElementById("push-notifications-prompt")&&ie(me).mount("#push-notifications-prompt-container")},xe=M(async function(e){document.getElementById("lot-info.traditional")!=null&&await A(e)},3e3),ke=M(async function(e){document.querySelector("#lot-info:not(.traditional)")!=null&&await A(e)},250),Pe=function(e,t){if(e===l("#lot-info").data("lotId"))return t()};function b(e){ke(e),xe(e)}const Ie=function(e,t){if(e===l("#lot-info").data("lotId"))return b(t)},Ce=(e,t)=>{Pe(e,()=>{N.getAnnouncedBids(e,t,function(i){const s=i[0];if(s!=null)return ne("#lot-events",s.bidAmount.amount,{speed:"slowest",textSize:"tw-text-xl small:tw-text-2xl"})})})},T=function(){E(),$(),we(function(){b(Date.now())}),l(".yass").yass()};oe(T);document.addEventListener("turbo:render",T);document.addEventListener("br:page:refresh",()=>{E(),$()});h.on("*",Ie);h.on("bidRegistered",Ce);h.onConnected(()=>{b(Date.now())});se.onAwaken(()=>b(Date.now()));document.addEventListener("turbo:load",De);
//# sourceMappingURL=show-lot-Do76P2_a.js.map
